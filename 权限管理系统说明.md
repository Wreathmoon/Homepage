# 智能报价助手 - 权限管理系统说明

## 概述

智能报价助手现已集成完整的权限管理系统，支持管理员和普通用户两种角色，实现了账号管理、注册码管理、供应商删除等功能。

## 用户角色

### 管理员（admin）
- **默认账号**: `CHINAUNICOM_ADMIN`
- **默认密码**: `admin_password01!`
- **权限**:
  - 所有普通用户权限
  - 删除供应商
  - 查看所有用户账号
  - 删除用户账号
  - 生成注册码
  - 查看注册码使用情况

### 普通用户（user）
- **默认账号**: `user`
- **默认密码**: `123456`
- **权限**:
  - 询价邮件功能
  - 供应商查询
  - 供应商录入
  - 历史报价查询
  - 报价文件上传

## 主要功能

### 1. 用户登录与注册

#### 登录功能
- 支持管理员和普通用户登录
- 自动识别用户角色
- 会话保持24小时

#### 注册功能
- 新用户注册需要管理员提供的注册码
- 注册码有效期24小时
- 注册码一次性使用，用完自动失效
- 注册成功后自动分配普通用户权限

### 2. 账号管理（管理员专用）

管理员登录后，右上角用户菜单中会显示"账号管理"选项，点击进入账号管理页面。

#### 用户列表管理
- 查看所有注册用户
- 显示用户名、显示名称、角色、创建者、创建时间
- 删除用户账号（不能删除自己）
- 实时刷新用户列表

#### 注册码管理
- 生成新的注册码
- 查看未过期的注册码
- 显示注册码状态（已使用/未使用）
- 一键复制注册码到剪贴板
- 自动删除过期的注册码

### 3. 供应商管理增强

#### 普通用户
- 查看供应商列表
- 添加新供应商
- 查看供应商详情、联系人、产品类型

#### 管理员专用
- 删除供应商功能
- 在供应商查询页面的操作列中显示"删除"按钮
- 删除前需要确认，防止误操作
- 删除后自动刷新列表

### 4. 权限控制

#### 前端权限
- 基于用户角色显示/隐藏功能按钮
- 管理员菜单项仅对管理员可见
- 删除按钮仅对管理员显示

#### 后端权限
- API接口权限验证
- 管理员操作需要验证用户角色
- 防止权限绕过攻击

## 使用流程

### 管理员操作流程

1. **生成注册码**
   - 登录管理员账号
   - 右上角菜单 → 账号管理
   - 点击"生成注册码"按钮
   - 复制注册码提供给新用户

2. **管理用户账号**
   - 在账号管理页面查看所有用户
   - 删除不需要的用户账号
   - 查看注册码使用情况

3. **管理供应商**
   - 在供应商查询页面可以删除供应商
   - 删除前会有确认提示

### 普通用户注册流程

1. **获取注册码**
   - 联系管理员获取注册码
   - 注册码有效期24小时

2. **注册账号**
   - 在登录页面点击"还没有账号？点击注册"
   - 填写用户名、显示名称、密码、注册码
   - 点击注册按钮

3. **登录使用**
   - 注册成功后返回登录页面
   - 使用新账号登录系统

## 技术实现

### 前端
- React + TypeScript
- Semi Design UI组件库
- Context API进行状态管理
- 本地存储保持登录状态

### 后端
- Node.js + Express
- MongoDB数据库
- JWT Token（规划中）
- 权限中间件验证

### 数据库模型
- **User**: 用户信息和角色
- **RegistrationCode**: 注册码管理
- **Vendor**: 供应商信息（已有）
- **Quotation**: 报价信息（已有）

## 安全特性

1. **权限验证**: 前后端双重权限验证
2. **注册码机制**: 防止恶意注册
3. **会话管理**: 自动过期保护
4. **操作确认**: 重要操作需要确认
5. **审计日志**: 记录操作者信息

## 部署说明

### 数据库初始化
运行以下命令初始化默认用户：
```bash
cd server
node scripts/seed.js
```

### 环境配置
确保`.env`文件包含MongoDB连接字符串：
```
MONGODB_URI=mongodb://localhost:27017/quotation_system
```

## 注意事项

1. **默认密码**: 生产环境请及时修改默认管理员密码
2. **注册码安全**: 注册码应通过安全渠道传递
3. **权限检查**: 重要操作前请确认用户权限
4. **数据备份**: 删除操作不可恢复，请定期备份数据
5. **会话安全**: 公共电脑使用后请及时登出

## 后续规划

1. **密码加密**: 实现bcrypt密码加密
2. **JWT Token**: 替换现有的简单认证机制
3. **操作日志**: 详细的用户操作审计日志
4. **角色扩展**: 支持更多自定义角色
5. **批量操作**: 支持批量用户管理
6. **邮件通知**: 注册码通过邮件发送 