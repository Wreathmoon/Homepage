===============================================================================
                    æ™ºèƒ½æŠ¥ä»·åŠ©æ‰‹ - è”é€šäº‘éƒ¨ç½²æ–¹æ¡ˆ
===============================================================================

ç‰ˆæœ¬: v1.0.0
æ›´æ–°æ—¶é—´: 2024-12-13
é€‚ç”¨å¹³å°: ä¸­å›½è”é€šäº‘
é¡¹ç›®: React + Node.js + MongoDB æ™ºèƒ½æŠ¥ä»·åŠ©æ‰‹

===============================================================================
                              äº‘èµ„æºç”¨é€”è¯´æ˜
===============================================================================

æ ¹æ®æ‚¨çš„è”é€šäº‘æ§åˆ¶å°ï¼Œå½“å‰æ‹¥æœ‰çš„èµ„æºåŠç”¨é€”ï¼š

ğŸ–¥ï¸ äº‘æœåŠ¡å™¨ ECS (1å°)
   ç”¨é€”: éƒ¨ç½²åº”ç”¨ç¨‹åºä¸»ä½“
   - è¿è¡Œå‰ç«¯Reactåº”ç”¨ (ç«¯å£80)
   - è¿è¡ŒAIåˆ†ææœåŠ¡å™¨ (ç«¯å£8080) 
   - è¿è¡ŒMongoDB APIæœåŠ¡å™¨ (ç«¯å£8081)
   - å®‰è£…Nginxåå‘ä»£ç†

ğŸ’¾ äº‘ç¡¬ç›˜ BSS (2ä¸ª)
   ç”¨é€”: æ•°æ®å­˜å‚¨å’Œå¤‡ä»½
   - ç¡¬ç›˜1: ç³»ç»Ÿç›˜ + åº”ç”¨ç¨‹åº
   - ç¡¬ç›˜2: æ•°æ®ç›˜ (ä¸Šä¼ æ–‡ä»¶ã€æ•°æ®åº“æ–‡ä»¶ã€æ—¥å¿—)

ğŸŒ ä¸“æœ‰ç½‘ç»œ VPC (1ä¸ª)
   ç”¨é€”: ç½‘ç»œå®‰å…¨éš”ç¦»
   - åˆ›å»ºç§æœ‰ç½‘ç»œç¯å¢ƒ
   - é…ç½®å®‰å…¨ç»„è§„åˆ™
   - å†…ç½‘é€šä¿¡ä¼˜åŒ–

ğŸ”— å¼¹æ€§å…¬ç½‘IP EIP (1ä¸ª)
   ç”¨é€”: å¤–ç½‘è®¿é—®å…¥å£
   - ç»‘å®šåˆ°ECSæœåŠ¡å™¨
   - é…ç½®åŸŸåè§£æ
   - HTTPSè¯ä¹¦ç»‘å®š

ğŸ“Š äº‘æ•°æ®åº“ MongoDB (å¯é€‰)
   ç”¨é€”: ç”Ÿäº§çº§æ•°æ®åº“æœåŠ¡
   - æ›¿ä»£æœ¬åœ°MongoDB
   - è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤
   - é«˜å¯ç”¨æ€§ä¿éšœ

===============================================================================
                              æ¨èéƒ¨ç½²æ¶æ„
===============================================================================

æ–¹æ¡ˆä¸€: å•æœåŠ¡å™¨éƒ¨ç½² (æˆæœ¬ä½ï¼Œé€‚åˆåˆæœŸ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ECSäº‘æœåŠ¡å™¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nginx (80/443ç«¯å£)                      â”‚
â”‚ â”œâ”€â”€ é™æ€æ–‡ä»¶æœåŠ¡ (Reactæ„å»ºæ–‡ä»¶)           â”‚
â”‚ â”œâ”€â”€ åå‘ä»£ç†åˆ°AIæœåŠ¡ (8080ç«¯å£)           â”‚
â”‚ â””â”€â”€ åå‘ä»£ç†åˆ°APIæœåŠ¡ (8081ç«¯å£)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Node.jsåº”ç”¨                             â”‚
â”‚ â”œâ”€â”€ AIåˆ†ææœåŠ¡å™¨ (server.js:8080)        â”‚
â”‚ â”œâ”€â”€ APIæ•°æ®åº“æœåŠ¡å™¨ (server/app.js:8081) â”‚
â”‚ â””â”€â”€ PM2è¿›ç¨‹ç®¡ç†                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MongoDBæœ¬åœ°æ•°æ®åº“ (27017ç«¯å£)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶å­˜å‚¨ (æŒ‚è½½äº‘ç¡¬ç›˜)                     â”‚
â”‚ â”œâ”€â”€ /uploads (ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶)               â”‚
â”‚ â”œâ”€â”€ /temp_ocr (OCRä¸´æ—¶æ–‡ä»¶)              â”‚
â”‚ â””â”€â”€ /logs (åº”ç”¨æ—¥å¿—)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆäºŒ: äº‘æ•°æ®åº“åˆ†ç¦» (é«˜å¯ç”¨ï¼Œæ¨èç”Ÿäº§)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ECSäº‘æœåŠ¡å™¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨å±‚ (åŒæ–¹æ¡ˆä¸€)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ ç½‘ç»œè¿æ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          äº‘æ•°æ®åº“ MongoDB                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… è‡ªåŠ¨å¤‡ä»½                              â”‚
â”‚ âœ… é«˜å¯ç”¨é›†ç¾¤                            â”‚
â”‚ âœ… æ€§èƒ½ç›‘æ§                              â”‚
â”‚ âœ… å®‰å…¨åŠ å›º                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

===============================================================================
                              å…·ä½“æ“ä½œæ­¥éª¤
===============================================================================

ç¬¬ä¸€æ­¥: ECSæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡
-----------------------
1. ç™»å½•ECSæœåŠ¡å™¨ (é€šè¿‡SSH)
   ssh root@æ‚¨çš„ECSå…¬ç½‘IP

2. æ›´æ–°ç³»ç»Ÿ
   yum update -y  # CentOS
   # æˆ–
   apt update && apt upgrade -y  # Ubuntu

3. å®‰è£…åŸºç¡€è½¯ä»¶
   # å®‰è£…Node.js 18
   curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
   yum install -y nodejs
   
   # å®‰è£…MongoDB
   # å‚è€ƒUbuntuéƒ¨ç½²æŒ‡å—.txtä¸­çš„MongoDBå®‰è£…æ­¥éª¤
   
   # å®‰è£…Nginx
   yum install -y nginx
   
   # å®‰è£…PM2
   npm install -g pm2

ç¬¬äºŒæ­¥: äº‘ç¡¬ç›˜æŒ‚è½½é…ç½®
-------------------
1. æŒ‚è½½æ•°æ®ç›˜åˆ°ECS
   # åœ¨è”é€šäº‘æ§åˆ¶å°æ“ä½œ:
   # ECSå®ä¾‹ â†’ äº‘ç¡¬ç›˜ â†’ æŒ‚è½½ â†’ é€‰æ‹©æ•°æ®ç›˜

2. æ ¼å¼åŒ–å’ŒæŒ‚è½½ç¡¬ç›˜
   # æŸ¥çœ‹ç¡¬ç›˜
   lsblk
   
   # æ ¼å¼åŒ– (å‡è®¾æ˜¯/dev/vdb)
   mkfs.ext4 /dev/vdb
   
   # åˆ›å»ºæŒ‚è½½ç‚¹
   mkdir -p /data
   
   # æŒ‚è½½
   mount /dev/vdb /data
   
   # è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½
   echo '/dev/vdb /data ext4 defaults 0 0' >> /etc/fstab

3. åˆ›å»ºåº”ç”¨ç›®å½•
   mkdir -p /data/quotation-app
   mkdir -p /data/uploads
   mkdir -p /data/logs
   mkdir -p /data/mongodb

ç¬¬ä¸‰æ­¥: é¡¹ç›®éƒ¨ç½²
--------------
1. ä¸Šä¼ é¡¹ç›®ä»£ç 
   # æ–¹æ³•1: ä½¿ç”¨git
   cd /data/quotation-app
   git clone https://github.com/your-repo/quotation-helper.git
   
   # æ–¹æ³•2: ä½¿ç”¨scpä¸Šä¼ 
   scp -r ./Homepage root@ECSå…¬ç½‘IP:/data/quotation-app/

2. å®‰è£…ä¾èµ–
   cd /data/quotation-app/Homepage
   npm install
   
   # å®‰è£…æœåŠ¡å™¨ç«¯ä¾èµ–
   cd server
   npm install
   cd ..

3. æ„å»ºå‰ç«¯
   npm run build

ç¬¬å››æ­¥: ç¯å¢ƒå˜é‡é…ç½®
-----------------
1. åˆ›å»ºä¸»æœåŠ¡å™¨ç¯å¢ƒå˜é‡
   vim /data/quotation-app/Homepage/.env
   
   # æ·»åŠ å†…å®¹:
   NODE_ENV=production
   PORT=8080
   UPLOAD_LIMIT=50mb
   
   # å…ƒæ™¯AIé…ç½®
   YUANJING_API_KEY=sk-your-api-key-here
   YUANJING_MODEL=yuanjing-70b-chat
   YUANJING_API_ENDPOINT=https://maas-api.ai-yuanjing.com/openapi/compatible-mode/v1
   
   # MongoDBé…ç½®
   MONGODB_URI=mongodb://localhost:27017/quotation_db

2. åˆ›å»ºAPIæœåŠ¡å™¨ç¯å¢ƒå˜é‡
   vim /data/quotation-app/Homepage/server/.env
   
   # æ·»åŠ å†…å®¹:
   NODE_ENV=production
   PORT=8081
   
   # æ•°æ®åº“é…ç½®
   MONGODB_URI=mongodb://localhost:27017/quotation_system
   
   # è·¨åŸŸé…ç½®
   FRONTEND_URL=http://æ‚¨çš„åŸŸåæˆ–IP
   
   # å®‰å…¨é…ç½®
   JWT_SECRET=your-super-secret-jwt-key-change-this
   BCRYPT_ROUNDS=12
   
   # æ–‡ä»¶ä¸Šä¼ é…ç½®
   MAX_FILE_SIZE=10485760
   UPLOAD_DIR=/data/uploads

ç¬¬äº”æ­¥: Nginxé…ç½®
---------------
1. åˆ›å»ºNginxé…ç½®æ–‡ä»¶
   vim /etc/nginx/conf.d/quotation.conf
   
   # æ·»åŠ å†…å®¹:
   server {
       listen 80;
       server_name æ‚¨çš„åŸŸåæˆ–IP;
       
       # å‰ç«¯é™æ€æ–‡ä»¶
       location / {
           root /data/quotation-app/Homepage/build;
           try_files $uri $uri/ /index.html;
       }
       
       # AIåˆ†ææœåŠ¡ä»£ç†
       location /api/ {
           proxy_pass http://127.0.0.1:8080;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
       
       # MongoDB APIæœåŠ¡ä»£ç†
       location /api/vendors/ {
           proxy_pass http://127.0.0.1:8081;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
       
       location /api/quotations/ {
           proxy_pass http://127.0.0.1:8081;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
       
       # æ–‡ä»¶ä¸Šä¼ 
       location /uploads/ {
           alias /data/uploads/;
       }
   }

2. å¯åŠ¨Nginx
   systemctl start nginx
   systemctl enable nginx

ç¬¬å…­æ­¥: å¯åŠ¨åº”ç”¨æœåŠ¡
-----------------
1. ä½¿ç”¨PM2å¯åŠ¨åº”ç”¨
   cd /data/quotation-app/Homepage
   
   # å¯åŠ¨AIåˆ†ææœåŠ¡å™¨
   pm2 start server.js --name "ai-server"
   
   # å¯åŠ¨APIæ•°æ®åº“æœåŠ¡å™¨
   pm2 start server/app.js --name "api-server"
   
   # æŸ¥çœ‹çŠ¶æ€
   pm2 status
   pm2 logs

2. è®¾ç½®PM2å¼€æœºè‡ªå¯
   pm2 startup
   pm2 save

ç¬¬ä¸ƒæ­¥: å®‰å…¨ç»„é…ç½®
---------------
åœ¨è”é€šäº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™:

å…¥æ–¹å‘è§„åˆ™:
- HTTP: 80ç«¯å£ â†’ 0.0.0.0/0
- HTTPS: 443ç«¯å£ â†’ 0.0.0.0/0  
- SSH: 22ç«¯å£ â†’ æ‚¨çš„IPåœ°å€
- è‡ªå®šä¹‰: 8080ç«¯å£ â†’ 127.0.0.1 (å†…ç½‘è®¿é—®)
- è‡ªå®šä¹‰: 8081ç«¯å£ â†’ 127.0.0.1 (å†…ç½‘è®¿é—®)

å‡ºæ–¹å‘è§„åˆ™:
- å…¨éƒ¨æµé‡ â†’ 0.0.0.0/0

ç¬¬å…«æ­¥: åŸŸåå’ŒSSLé…ç½® (å¯é€‰)
-------------------------
1. åŸŸåè§£æ
   åœ¨æ‚¨çš„åŸŸåæœåŠ¡å•†å¤„æ·»åŠ Aè®°å½•:
   @ â†’ æ‚¨çš„ECSå…¬ç½‘IP
   www â†’ æ‚¨çš„ECSå…¬ç½‘IP

2. SSLè¯ä¹¦ç”³è¯·
   # ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦
   yum install -y certbot python3-certbot-nginx
   certbot --nginx -d yourdomain.com -d www.yourdomain.com

===============================================================================
                              æµ‹è¯•éªŒè¯
===============================================================================

éƒ¨ç½²å®Œæˆåçš„æµ‹è¯•æ­¥éª¤:

1. åŸºç¡€è¿é€šæ€§æµ‹è¯•
   curl http://æ‚¨çš„IPæˆ–åŸŸå
   # åº”è¯¥è¿”å›Reactåº”ç”¨çš„HTML

2. APIæ¥å£æµ‹è¯•
   curl http://æ‚¨çš„IPæˆ–åŸŸå/api/health
   # åº”è¯¥è¿”å›å¥åº·æ£€æŸ¥ä¿¡æ¯

3. æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
   # é€šè¿‡æµè§ˆå™¨è®¿é—®ç³»ç»Ÿï¼Œæµ‹è¯•Excel/PDFä¸Šä¼ åŠŸèƒ½

4. AIåˆ†ææµ‹è¯•
   # ä¸Šä¼ æµ‹è¯•æ–‡ä»¶ï¼ŒéªŒè¯AIè¯†åˆ«å’Œæ•°æ®æ¸…æ´—åŠŸèƒ½

5. æ•°æ®åº“è¿æ¥æµ‹è¯•
   # æ£€æŸ¥æŠ¥ä»·æ•°æ®æ˜¯å¦æ­£ç¡®å­˜å‚¨å’Œè¯»å–

===============================================================================
                              ç›‘æ§å’Œç»´æŠ¤
===============================================================================

æ—¥å¸¸ç»´æŠ¤å‘½ä»¤:
-----------
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs ai-server
pm2 logs api-server

# é‡å¯åº”ç”¨
pm2 restart ai-server
pm2 restart api-server

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h

# æŸ¥çœ‹MongoDBçŠ¶æ€
systemctl status mongod

# å¤‡ä»½æ•°æ®åº“
mongodump --db quotation_db --out /data/backup/$(date +%Y%m%d)

æ€§èƒ½ä¼˜åŒ–å»ºè®®:
-----------
1. å¯ç”¨Nginx gzipå‹ç¼©
2. é…ç½®é™æ€æ–‡ä»¶ç¼“å­˜
3. ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
4. å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—
5. ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ

===============================================================================
                              æ•…éšœæ’é™¤
===============================================================================

å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ:

1. åº”ç”¨æ— æ³•å¯åŠ¨
   - æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨: netstat -tlnp | grep :8080
   - æŸ¥çœ‹PM2æ—¥å¿—: pm2 logs
   - æ£€æŸ¥ç¯å¢ƒå˜é‡: cat .env

2. æ•°æ®åº“è¿æ¥å¤±è´¥
   - æ£€æŸ¥MongoDBæœåŠ¡: systemctl status mongod
   - éªŒè¯è¿æ¥å­—ç¬¦ä¸²: mongo mongodb://localhost:27017/quotation_db
   - æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®: firewall-cmd --list-all

3. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
   - æ£€æŸ¥ç›®å½•æƒé™: ls -la /data/uploads
   - æŸ¥çœ‹ç£ç›˜ç©ºé—´: df -h
   - æ£€æŸ¥Nginxé…ç½®: nginx -t

4. AIæ¥å£è°ƒç”¨å¤±è´¥
   - éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹APIè°ƒç”¨æ—¥å¿—

===============================================================================
                              è”ç³»æ”¯æŒ
===============================================================================

æŠ€æœ¯æ”¯æŒ:
- è”é€šäº‘å®¢æœ: 10010
- æŠ€æœ¯æ–‡æ¡£: https://www.chinaunicom.com.cn/
- å·¥å•ç³»ç»Ÿ: è”é€šäº‘æ§åˆ¶å° â†’ å·¥å•

é¡¹ç›®æ”¯æŒ:
- æŸ¥çœ‹é¡¹ç›®æ—¥å¿—æ–‡ä»¶
- è”ç³»é¡¹ç›®å¼€å‘å›¢é˜Ÿ
- å‚è€ƒUbuntuéƒ¨ç½²æŒ‡å—.txt

=============================================================================== 