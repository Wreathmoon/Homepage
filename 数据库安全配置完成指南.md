# 🔐 数据库安全配置完成指南

## ✅ 已完成的步骤

1. **✅ 创建了数据库管理员用户**
   - 用户名: `dbadmin`
   - 密码: `QuotationDB_Admin_2024!`
   - 权限: 完整数据库管理权限

2. **✅ 创建了应用程序用户**
   - 用户名: `quotation_app`
   - 密码: `QuotationApp_2024!`  
   - 权限: 仅限 quotation_system 数据库读写

## 🚨 需要您完成的步骤

### 第一步：更新应用程序配置

请在 `server` 目录下创建或修改 `.env` 文件：

```env
# 服务器配置
PORT=3001
NODE_ENV=development

# 数据库配置 - 安全连接
MONGODB_URI=mongodb://quotation_app:QuotationApp_2024!@localhost:27017/quotation_system

# 跨域配置  
FRONTEND_URL=http://localhost:3000,http://localhost:8080,http://103.77.22.42,http://103.77.22.42:8080

# JWT密钥
JWT_SECRET=QuotationSystem_JWT_Secret_2024_Change_In_Production

# 文件上传配置
MAX_FILE_SIZE=10485760
UPLOAD_DIR=./uploads

# 安全配置
BCRYPT_ROUNDS=12
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=100
```

### 第二步：启用MongoDB认证

#### Windows系统：

1. **找到MongoDB配置文件**
   - 路径通常在: `C:\Program Files\MongoDB\Server\[版本]\bin\mongod.cfg`
   - 或者: `C:\ProgramData\MongoDB\`

2. **修改配置文件**
   在配置文件中添加或修改：
   ```yaml
   security:
     authorization: enabled
   ```

3. **重启MongoDB服务**
   ```cmd
   # 以管理员身份运行命令提示符
   net stop MongoDB
   net start MongoDB
   ```

#### 或者临时启用认证（测试用）：
```cmd
# 停止当前MongoDB服务
net stop MongoDB

# 以认证模式启动 (在MongoDB安装目录的bin文件夹中运行)
mongod --auth --config "C:\Program Files\MongoDB\Server\[版本]\bin\mongod.cfg"
```

### 第三步：验证安全配置

运行以下测试：

```bash
# 测试1: 未认证连接应该失败
mongosh mongodb://localhost:27017/quotation_system --eval "db.users.find()"

# 测试2: 认证连接应该成功
mongosh mongodb://quotation_app:QuotationApp_2024!@localhost:27017/quotation_system --eval "db.users.count()"
```

### 第四步：测试应用程序连接

启动后端服务器：
```bash
cd server
npm start
```

如果看到"✅ MongoDB连接成功"，说明配置正确。

## 🔑 重要凭据信息

### 应用程序数据库用户
- **用户名**: `quotation_app`
- **密码**: `QuotationApp_2024!`
- **数据库**: `quotation_system`
- **权限**: 读写
- **连接字符串**: `mongodb://quotation_app:QuotationApp_2024!@localhost:27017/quotation_system`

### 数据库管理员用户  
- **用户名**: `dbadmin`
- **密码**: `QuotationDB_Admin_2024!`
- **数据库**: `admin`
- **权限**: 完整管理
- **连接字符串**: `mongodb://dbadmin:QuotationDB_Admin_2024!@localhost:27017/admin`

## 🛡️ 安全状态对比

### 之前 (不安全)
- ❌ 无身份验证
- ❌ 任何人都可连接
- ❌ 无访问控制
- ❌ 数据完全暴露

### 现在 (安全)
- ✅ 启用身份验证
- ✅ 用户权限隔离
- ✅ 应用专用账户
- ✅ 管理员分离

## 🔧 管理操作示例

### 使用管理员权限
```bash
# 连接为管理员
mongosh mongodb://dbadmin:QuotationDB_Admin_2024!@localhost:27017/admin

# 查看所有数据库
show dbs

# 查看数据库用户
db.getUsers()

# 创建新用户
db.createUser({...})
```

### 使用应用程序权限
```bash
# 连接为应用用户
mongosh mongodb://quotation_app:QuotationApp_2024!@localhost:27017/quotation_system

# 查看集合 (仅限quotation_system数据库)
show collections

# 查询数据
db.users.find()
```

## ⚠️ 注意事项

1. **保存密码**: 请将这些凭据保存在安全的地方
2. **定期更换**: 建议定期更换密码
3. **生产环境**: 生产部署时使用更复杂的密码
4. **备份配置**: 保存MongoDB配置文件的备份
5. **测试连接**: 完成配置后务必测试连接

## 🚨 如果遇到问题

### 连接被拒绝
- 确认MongoDB服务已启动
- 确认已启用认证
- 检查用户名密码是否正确

### 应用无法启动
- 检查.env文件中的连接字符串
- 确认MongoDB用户权限
- 查看错误日志

### 忘记密码
- 使用`--noauth`模式启动MongoDB
- 重置用户密码
- 重新启用认证

现在您的数据库已经拥有了企业级的安全保护！🔒 